/* stylelint-disable selector-max-specificity, no-descending-specificity */
@import '../abstracts/variables';
$icon-size: 24px;
$tick: './tick.svg';
$cross: './cross.svg';
$exclamation: './error.svg';

@mixin input-icon($color) {
  border: 1px solid $color;
  color: $color;
  border-radius: 50%;
  height: $icon-size;
  width: $icon-size;
  font-size: $icon-size / 2;
  content: '';
  position: absolute;
}

@mixin icon-after($svg, $color) {
  content: '';
  background-image: svg-load($svg, fill= $color);
  background-repeat: no-repeat;
  background-size: contain;
  position: absolute;
}

@mixin focus($color) {
  border-color: $color;
  box-shadow: 0 0 10px rgba($color, 0.35);
  outline: unset;
}

/* Stupid browser overrides require element selectors */
/* stylelint-disable */
input[type='search']::-webkit-search-decoration,
input[type='search']::-webkit-search-cancel-button,
input[type='search']::-webkit-search-results-button,
input[type='search']::-webkit-search-results-decoration {
  display: none;
}

input[type='text'],
input[type='search'] {
  &::-ms-clear,
  &::-ms-reveal {
    display: none;
    width: 0;
    height: 0;
  }
}

/* stylelint-enable */

.form-control {
  @include font-standard;

  width: 100%;
  height: $control-height-base;
  padding: 8px 16px;
  font-size: 16.5px;
  background-color: $color-white;
  background-image: none;
  border: $border-base;
  border-radius: 3px;
  transition: border-color 0.15s ease-out;
  margin-bottom: 5px;
  text-transform: none;
  box-sizing: border-box;
}

.form-group {
  display: flex;
  flex-direction: column;
  align-items: stretch;
  line-height: $line-height-base;
  margin-bottom: 20px;

  &__label {
    @include font-bold;

    letter-spacing: 0.02em;
    margin-bottom: 2px;
    color: $color-grey-dark;
  }

  &__input-wrapper {
    position: relative;
    display: flex;
    align-items: center;
  }

  &__input {
    @extend .form-control;
  }

  &__input-clear,
  &__icon-valid,
  &__icon-error {
    display: none;
  }

  &__validation {
    display: none;
    margin-bottom: 2px;
    color: $color-rust;
  }
}

.form-group__input-clear {
  position: absolute;
  right: 15px;
  top: ($control-height-base - $icon-size) / 2 - 1px;
  height: $icon-size;
  width: $icon-size;

  &::before {
    @include input-icon($color-grey-dark);
  }

  &::after {
    @include icon-after($cross, $color-grey-dark);

    width: 14px;
    height: 14px;
    margin: 6px;
  }
}

.form-group__icon-valid {
  position: absolute;
  right: 15px;
  top: ($control-height-base - $icon-size) / 2 - 1px;
  height: $icon-size;
  width: $icon-size;

  &::before {
    @include input-icon($color-green);
  }

  &::after {
    @include icon-after($tick, $color-green);

    width: 16px;
    height: 16px;
    margin: 7px 5px;
  }
}

.form-group__icon-error {
  position: absolute;
  right: 15px;
  top: ($control-height-base - $icon-size) / 2 - 1px;
  height: $icon-size;
  width: $icon-size;

  &::before {
    @include input-icon($color-rust);
  }

  &::after {
    @include icon-after($exclamation, $color-rust);

    width: 14px;
    height: 14px;
    margin: 5px 12px;
  }
}

.form-group--focus {
  .form-group__input-clear {
    display: none;
  }

  .form-group__input:focus {
    @include focus($color-blue-cobalt);
  }
}

.form-group--populated {
  .form-group__input-clear {
    display: block;
  }
}

/****** ERROR ******/

.form-group--error {
  .form-group__validation {
    display: block;
  }

  .form-group__input {
    border-color: $color-rust;
    background-color: $color-alert-orange;
  }

  .form-group__input-clear,
  .form-group__icon-valid {
    display: none;
  }

  .form-group__icon-error {
    display: block;
  }

  &.form-group--focus {
    .form-group__input:focus {
      @include focus($color-rust);
    }

    .form-group__icon-error {
      display: none;
    }

    .form-group__input-clear {
      display: block;
    }
  }
}

/****** VALID ******/

.form-group--valid {
  .form-group__input-clear,
  .form-group__icon-error {
    display: none;
  }

  .form-group__icon-valid {
    display: block;
  }

  &.form-group--focus {
    .form-group__input:focus {
      @include focus($color-green);
    }

    .form-group__icon-valid {
      display: none;
    }

    .form-group__input-clear {
      display: block;
    }
  }
}
